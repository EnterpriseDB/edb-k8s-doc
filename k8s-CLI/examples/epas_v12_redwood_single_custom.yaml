---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: edb-epas12-redwood-single
  name: edb-epas-v12-redwood-single
spec:
  type: ClusterIP
  ports:
  - name: postgres
    port: 5444
    protocol: TCP
    targetPort: 5444
  selector:
    app: edb-epas12-redwood-single
---
apiVersion: v1
kind: Pod
metadata:
  name: edb-epas-v12-redwood-single
  labels:
    app: edb-epas12-redwood-single
spec:
  serviceAccountName: edb-cli
  imagePullSecrets:
  - name: quay-regsecret
  containers:
    - name: edb-database
      image: "quay.io/edb/postgres-advanced-server-12:latest"
      imagePullPolicy: Always
      command: ["/bin/bash"]
      args: ["-ec", "/police.sh && /launch.sh"]
      env:
        - name: PG_INITDB
          value: "true"
        - name: PG_USER
          value: enterprisedb
        - name: PG_PASSWORD
          value: edb
        - name: PGDATA
          value: /var/lib/edb/data
        - name: PGDATA_WAL
          value: /var/lib/edb/wal
        - name: PGDATA_ARCHIVE
          value: /var/lib/edb/wal_archive
        - name: USE_CONFIGMAP
          value: "true"
        - name: NO_REDWOOD_COMPAT
          value: "false"
        - name: CHARSET
          value: UTF8
      ports:
        - name: postgres
          containerPort: 5444
          protocol: TCP
      livenessProbe:
        initialDelaySeconds: 10
        periodSeconds: 10
        tcpSocket:
          port: 5444
      readinessProbe:
        initialDelaySeconds: 10
        periodSeconds: 10
        tcpSocket:
          port: 5444
      resources:
        limits:
          memory: 1Gi
          cpu: 2
        requests:
          memory: 500Mi
          cpu: 1
      volumeMounts:
        - name: config-volume
          mountPath: /config
  volumes:
    - name: config-volume
      configMap:
        name: edb-cli-db-custom-config



